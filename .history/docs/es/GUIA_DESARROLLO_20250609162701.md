# ğŸ‘¨â€ğŸ’» GuÃ­a de Desarrollo TeraDeck Online

## ğŸš€ ConfiguraciÃ³n Inicial

### ğŸ“‹ Prerrequisitos

```mermaid
graph LR
    A[Node.js 18+] --> B[npm 8+]
    B --> C[Git]
    C --> D[Editor de cÃ³digo]
    D --> E[Terminal]
```

- **Node.js**: VersiÃ³n 18.0.0 o superior
- **npm**: VersiÃ³n 8.0.0 o superior  
- **Git**: Para control de versiones
- **Editor**: VS Code recomendado con extensiones TypeScript

### ğŸ› ï¸ InstalaciÃ³n del Proyecto

```bash
# Clonar el repositorio
git clone https://github.com/tu-usuario/teradeck-online.git
cd teradeck-online

# Instalar dependencias del monorepo
npm install

# Instalar dependencias de todos los workspaces
npm run install:all

# Construir mÃ³dulo compartido
npm run build:shared
```

### âš™ï¸ ConfiguraciÃ³n del Entorno

```bash
# Copiar variables de entorno
cp backend/.env.example backend/.env
cp frontend/.env.example frontend/.env

# Editar configuraciones segÃºn necesidad
nano backend/.env
nano frontend/.env
```

## ğŸ¯ Estructura del Proyecto

```mermaid
graph TD
    subgraph "ğŸ“¦ TeraDeck Monorepo"
        A[package.json] --> B[Workspace Root]
        
        B --> C[ğŸ“± frontend/]
        B --> D[ğŸ–¥ï¸ backend/]
        B --> E[ğŸ“š shared/]
        B --> F[ğŸ¨ assets/]
        B --> G[ğŸ“– docs/]
        B --> H[ğŸ§ª tests/]
        
        C --> C1[src/]
        C --> C2[public/]
        C --> C3[package.json]
        
        D --> D1[src/]
        D --> D2[tests/]
        D --> D3[package.json]
        
        E --> E1[src/]
        E --> E2[package.json]
    end
```

### ğŸ“ Frontend Structure

```
frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/        # Componentes React
â”‚   â”‚   â”œâ”€â”€ common/       # Componentes reutilizables
â”‚   â”‚   â”œâ”€â”€ game/         # Componentes del juego
â”‚   â”‚   â””â”€â”€ lobby/        # Componentes de lobby
â”‚   â”œâ”€â”€ hooks/            # Custom hooks
â”‚   â”œâ”€â”€ services/         # Servicios (API, Socket)
â”‚   â”œâ”€â”€ store/            # Estado global (Zustand)
â”‚   â”œâ”€â”€ types/            # Tipos TypeScript
â”‚   â”œâ”€â”€ styles/           # Estilos globales
â”‚   â”œâ”€â”€ i18n/             # InternacionalizaciÃ³n
â”‚   â”‚   â””â”€â”€ locales/      # Archivos de traducciÃ³n
â”‚   â””â”€â”€ assets/           # Recursos estÃ¡ticos
â”œâ”€â”€ public/               # Archivos pÃºblicos
â”‚   â”œâ”€â”€ manifest.json     # PWA manifest
â”‚   â””â”€â”€ icons/            # Iconos de la app
â””â”€â”€ vite.config.ts        # ConfiguraciÃ³n Vite
```

### ğŸ–¥ï¸ Backend Structure

```
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ controllers/      # Controladores Express
â”‚   â”œâ”€â”€ services/         # LÃ³gica de negocio
â”‚   â”œâ”€â”€ socket/           # Handlers de WebSocket
â”‚   â”œâ”€â”€ middleware/       # Middleware personalizado
â”‚   â””â”€â”€ utils/            # Utilidades
â”œâ”€â”€ tests/                # Tests del backend
â”‚   â”œâ”€â”€ unit/             # Tests unitarios
â”‚   â””â”€â”€ integration/      # Tests de integraciÃ³n
â””â”€â”€ package.json
```

### ğŸ“š Shared Structure

```
shared/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ types/            # Tipos compartidos
â”‚   â”œâ”€â”€ constants/        # Constantes del juego
â”‚   â”œâ”€â”€ game/             # LÃ³gica de juego
â”‚   â”œâ”€â”€ utils/            # Utilidades compartidas
â”‚   â””â”€â”€ i18n/             # Traducciones compartidas
â””â”€â”€ package.json
```

## ğŸ”§ Comandos de Desarrollo

### ğŸš€ Comandos Principales

```bash
# Desarrollo completo (frontend + backend)
npm run dev

# Solo frontend
npm run dev:frontend

# Solo backend  
npm run dev:backend

# Build completo
npm run build

# Tests
npm run test

# Linting
npm run lint
npm run lint:fix

# Type checking
npm run type-check
```

### ğŸ“¦ Comandos por Workspace

```bash
# Frontend
npm run dev --workspace=frontend
npm run build --workspace=frontend
npm run test --workspace=frontend

# Backend
npm run dev --workspace=backend
npm run build --workspace=backend
npm run test --workspace=backend

# Shared
npm run build --workspace=shared
npm run test --workspace=shared
```

## ğŸ® Flujo de Desarrollo

```mermaid
flowchart TD
    A[ğŸ†• Nueva Feature] --> B[Crear Branch]
    B --> C[Configurar Entorno]
    C --> D{Tipo de Feature}
    
    D -->|UI/UX| E[Desarrollar Frontend]
    D -->|API/Logic| F[Desarrollar Backend]
    D -->|Game Logic| G[Desarrollar Shared]
    
    E --> H[Escribir Tests]
    F --> H
    G --> H
    
    H --> I[Ejecutar Tests]
    I --> J{Â¿Tests Pasan?}
    J -->|No| K[Corregir Errores]
    K --> I
    J -->|SÃ­| L[Linting & Format]
    
    L --> M[Type Check]
    M --> N{Â¿Todo OK?}
    N -->|No| K
    N -->|SÃ­| O[Commit Changes]
    
    O --> P[Push Branch]
    P --> Q[Create Pull Request]
    Q --> R[Code Review]
    R --> S[Merge to Main]
```

## ğŸ§ª Testing Guidelines

### ğŸ¯ Estrategia de Testing

```mermaid
pyramid
    title Testing Pyramid
    
    "E2E Tests" : 10
    "Integration Tests" : 30  
    "Unit Tests" : 60
```

### âœ… Unit Tests

```typescript
// Ejemplo: shared/src/game/__tests__/gameLogic.test.ts
import { initializeGame, processGameAction } from '../gameLogic';
import { ActionType, CardType, ModuleColor } from '../../types/game';

describe('Game Logic', () => {
  test('should initialize game with correct state', () => {
    const players = [
      { id: 'player1', name: 'Alice', isAI: false },
      { id: 'player2', name: 'Bob', isAI: false }
    ];
    
    const gameState = initializeGame(players);
    
    expect(gameState.players).toHaveLength(2);
    expect(gameState.currentPlayerIndex).toBe(0);
    expect(gameState.deck.length).toBeGreaterThan(0);
  });
});
```

### ğŸ”— Integration Tests

```typescript
// Ejemplo: backend/tests/integration/gameManager.test.ts
import { GameManager } from '../../src/services/GameManager';
import { ActionType } from '@shared/types/game';

describe('GameManager Integration', () => {
  test('should handle complete game flow', async () => {
    const gameManager = new GameManager();
    const roomCode = await gameManager.createRoom('host', {});
    
    // Join players
    await gameManager.joinRoom(roomCode, 'player2');
    
    // Start game
    await gameManager.startGame(roomCode);
    
    // Play actions
    const action = {
      type: ActionType.PLAY_CARD,
      playerId: 'host',
      data: { /* card data */ }
    };
    
    const result = await gameManager.processAction(roomCode, action);
    expect(result.isValid).toBe(true);
  });
});
```

### ğŸ­ Frontend Component Tests

```typescript
// Ejemplo: frontend/src/components/__tests__/Card.test.tsx
import { render, screen } from '@testing-library/react';
import { Card } from '../common/Card';
import { CardType, ModuleColor } from '@shared/types/game';

describe('Card Component', () => {
  test('renders module card correctly', () => {
    const moduleCard = {
      id: 'test-card',
      type: CardType.MODULE,
      color: ModuleColor.BACKEND,
      name: { es: 'MÃ³dulo Backend', en: 'Backend Module' },
      // ... other props
    };
    
    render(<Card card={moduleCard} />);
    
    expect(screen.getByText('MÃ³dulo Backend')).toBeInTheDocument();
    expect(screen.getByTestId('card-backend')).toHaveClass('bg-blue-500');
  });
});
```

## ğŸ¨ Convenciones de CÃ³digo

### ğŸ“ Naming Conventions

```typescript
// âœ… Buenas prÃ¡cticas
// Componentes: PascalCase
const GameBoard = () => { /* ... */ };

// Hooks: camelCase con prefijo 'use'
const useGameState = () => { /* ... */ };

// Tipos: PascalCase
interface Player {
  id: string;
  name: string;
}

// Constantes: UPPER_SNAKE_CASE
const MAX_PLAYERS = 6;

// Funciones: camelCase
const calculateScore = (player: Player) => { /* ... */ };

// Archivos: kebab-case
// game-board.component.tsx
// use-game-state.hook.ts
```

### ğŸ¯ TypeScript Guidelines

```typescript
// âœ… Usar tipos estrictos
interface StrictPlayer {
  readonly id: string;
  name: string;
  isAI: boolean;
  modules: ModuleCard[];
}

// âœ… Usar union types para estados
type GameStatus = 'waiting' | 'playing' | 'finished';

// âœ… Usar generics cuando sea apropiado
interface ApiResponse<T> {
  data: T;
  success: boolean;
  error?: string;
}

// âŒ Evitar 'any'
// const badData: any = someFunction(); // âŒ
const goodData: Player = someFunction(); // âœ…
```

### ğŸ¨ React Patterns

```typescript
// âœ… Functional Components con hooks
const GameCard: React.FC<GameCardProps> = ({ card, onPlay }) => {
  const [isSelected, setIsSelected] = useState(false);
  const { t } = useTranslation();
  
  const handleClick = useCallback(() => {
    setIsSelected(true);
    onPlay(card);
  }, [card, onPlay]);
  
  return (
    <motion.div
      className="card"
      whileHover={{ scale: 1.05 }}
      onClick={handleClick}
    >
      {t(`cards.${card.type}.name`)}
    </motion.div>
  );
};

// âœ… Custom hooks para lÃ³gica reutilizable
const useGameActions = (gameState: GameState) => {
  const playCard = useCallback((card: Card, target?: Target) => {
    // LÃ³gica para jugar carta
  }, [gameState]);
  
  const discardCards = useCallback((cards: Card[]) => {
    // LÃ³gica para descartar
  }, []);
  
  return { playCard, discardCards };
};
```

## ğŸ”Œ WebSocket Development

### ğŸ“¡ Event Patterns

```typescript
// shared/src/types/socket.ts
interface SocketEvents {
  // Cliente â†’ Servidor
  'room:create': (data: CreateRoomData) => void;
  'room:join': (data: JoinRoomData) => void;
  'game:action': (data: GameActionData) => void;
  
  // Servidor â†’ Cliente  
  'room:created': (data: RoomCreatedData) => void;
  'game:state-updated': (data: GameState) => void;
  'game:error': (data: ErrorData) => void;
}

// backend/src/socket/gameHandler.ts
export const handleGameEvents = (io: Server, socket: Socket) => {
  socket.on('game:action', async (data: GameActionData) => {
    try {
      const result = await gameManager.processAction(data.roomCode, data.action);
      
      if (result.isValid) {
        io.to(data.roomCode).emit('game:state-updated', result.gameState);
      } else {
        socket.emit('game:error', { message: result.errorKey });
      }
    } catch (error) {
      socket.emit('game:error', { message: 'internal-error' });
    }
  });
};
```

### ğŸ¯ Error Handling

```typescript
// Frontend error handling
const useSocket = () => {
  const [error, setError] = useState<string | null>(null);
  
  useEffect(() => {
    socket.on('game:error', (errorData) => {
      setError(errorData.message);
      toast.error(t(`errors.${errorData.message}`));
    });
    
    socket.on('connect_error', () => {
      setError('connection-failed');
    });
    
    return () => {
      socket.off('game:error');
      socket.off('connect_error');
    };
  }, []);
  
  return { error, clearError: () => setError(null) };
};
```

## ğŸŒ Internationalization (i18n)

### ğŸ—£ï¸ Adding New Languages

```bash
# 1. Crear archivo de traducciÃ³n
touch frontend/src/i18n/locales/it.json
touch shared/src/i18n/locales/it.ts

# 2. Agregar al detector de idiomas
# frontend/src/i18n/index.ts
```

```typescript
// shared/src/i18n/locales/it.ts
export const it: Translations = {
  common: {
    welcome: 'Benvenuto',
    loading: 'Caricamento...',
    // ...
  },
  cards: {
    modules: {
      backend: {
        name: 'Modulo Backend',
        description: 'Server e logica di business'
      }
      // ...
    }
  }
};
```

### ğŸ¯ Translation Guidelines

```typescript
// âœ… Usar claves descriptivas
t('game.actions.playCard')  // âœ…
t('pc')                     // âŒ

// âœ… Usar interpolaciÃ³n para valores dinÃ¡micos
t('game.turn.current', { playerName: 'Alice' })

// âœ… Usar pluralizaciÃ³n
t('game.cards.count', { count: 5 })
```

## ğŸ¨ Styling Guidelines

### ğŸ¨ TailwindCSS Patterns

```typescript
// âœ… Usar clases consistentes
const cardStyles = {
  base: 'rounded-lg shadow-md p-4 transition-all duration-200',
  colors: {
    backend: 'bg-blue-500 text-white',
    frontend: 'bg-yellow-500 text-black',
    mobile: 'bg-red-500 text-white',
    dataScience: 'bg-green-500 text-white',
    multicolor: 'bg-gradient-to-r from-blue-500 to-red-500'
  },
  states: {
    hover: 'hover:scale-105',
    disabled: 'opacity-50 cursor-not-allowed'
  }
};

// âœ… Usar custom components para estilos complejos
const Card = ({ color, disabled, children }) => (
  <div className={cn(
    cardStyles.base,
    cardStyles.colors[color],
    !disabled && cardStyles.states.hover,
    disabled && cardStyles.states.disabled
  )}>
    {children}
  </div>
);
```

### âœ¨ Framer Motion Patterns

```typescript
// âœ… Animaciones consistentes
const cardVariants = {
  idle: { scale: 1, y: 0 },
  hover: { scale: 1.05, y: -5 },
  dragging: { scale: 1.1, rotate: 5, zIndex: 999 },
  played: { 
    scale: 0.8, 
    y: -100, 
    opacity: 0,
    transition: { duration: 0.3 }
  }
};

const AnimatedCard = ({ card, onPlay }) => (
  <motion.div
    variants={cardVariants}
    initial="idle"
    whileHover="hover"
    whileDrag="dragging"
    animate={card.isPlayed ? "played" : "idle"}
    onAnimationComplete={() => card.isPlayed && onPlay()}
  >
    <Card card={card} />
  </motion.div>
);
```

## ğŸš€ Build & Deploy

### ğŸ“¦ Build Process

```mermaid
flowchart TD
    A[Source Code] --> B[Type Check]
    B --> C[Lint & Format]
    C --> D[Unit Tests]
    D --> E[Build Shared]
    E --> F[Build Frontend]
    E --> G[Build Backend]
    F --> H[Bundle Assets]
    G --> I[Compile TypeScript]
    H --> J[Optimize PWA]
    I --> K[Create Distribution]
    J --> K
    K --> L[Deploy to Production]
```

### ğŸ¯ Environment Variables

```bash
# Backend (.env)
NODE_ENV=production
PORT=7777
CORS_ORIGIN=https://teradeck.app
SESSION_SECRET=your-secret-key

# Frontend (.env)
VITE_API_URL=https://api.teradeck.app
VITE_SOCKET_URL=https://socket.teradeck.app
VITE_APP_VERSION=1.0.0
```

## ğŸ¤ Contributing Guidelines

### ğŸ”„ Git Workflow

```bash
# 1. Crear feature branch
git checkout -b feature/nueva-funcionalidad

# 2. Hacer cambios y commits
git add .
git commit -m "feat: agregar nueva funcionalidad"

# 3. Push y crear PR
git push origin feature/nueva-funcionalidad
# Crear Pull Request en GitHub
```

### ğŸ“ Commit Conventions

```bash
# Tipos de commit
feat:     Nueva funcionalidad
fix:      CorrecciÃ³n de bugs
docs:     DocumentaciÃ³n
style:    Formato de cÃ³digo
refactor: Refactoring
test:     Tests
chore:    Mantenimiento

# Ejemplos
git commit -m "feat: agregar sistema de IA para jugadores"
git commit -m "fix: corregir bug en validaciÃ³n de cartas"
git commit -m "docs: actualizar README con instrucciones"
```

### ğŸ” Code Review Checklist

- [ ] âœ… CÃ³digo sigue las convenciones establecidas
- [ ] ğŸ§ª Tests incluidos y pasando
- [ ] ğŸ“ TypeScript types correctos
- [ ] ğŸŒ Traducciones actualizadas (si aplica)
- [ ] ğŸ“± Responsive design considerado
- [ ] â™¿ Accesibilidad implementada
- [ ] ğŸš€ Performance considerado
- [ ] ğŸ” Seguridad validada

---

## ğŸ†˜ Troubleshooting

### ğŸ› Problemas Comunes

```bash
# Error: Module not found
npm run build:shared
npm install

# Error: Port already in use
lsof -ti:3000 | xargs kill -9
lsof -ti:7777 | xargs kill -9

# Error: TypeScript compilation
npm run type-check
npm run lint:fix

# Error: Tests failing
npm run test -- --verbose
npm run test -- --watch
```

### ğŸ“ Obtener Ayuda

1. ğŸ“– Revisar documentaciÃ³n
2. ğŸ” Buscar en issues existentes
3. ğŸ’¬ Crear nuevo issue con detalles
4. ğŸ¤ Solicitar code review

---

**Â¡Happy Coding!** ğŸš€

**TeraDeck Development Team** ğŸ‘¨â€ğŸ’»ğŸ‘©â€ğŸ’» 